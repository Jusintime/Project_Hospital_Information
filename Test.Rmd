```{r, echo=FALSE, include=FALSE}
# Create a choropleth map of the United States that compares the average covered charges to the average total payments
library(dplyr)
hospital.data <- read.csv("data/hospital_data.csv", stringsAsFactors = F)
hospital.data.shortened <- hospital.data %>%
  select(Provider.City, Provider.State, Average.Covered.Charges, Average.Total.Payments) %>% 
  group_by(Provider.State) %>% 
  summarize(State.Covered.Charges = mean(as.numeric(gsub("\\$", "", Average.Covered.Charges)) / as.numeric(gsub("\\$", "", Average.Total.Payments))))
source("scripts/choropleth.r")
stateChoropleth <- makeCountryChoropleth(hospital.data.shortened)
```
#State Choropleth Map: Best Insurance Coverage

`r stateChoropleth`

```{r, echo=FALSE, include=FALSE}
# Create a choropleth map of each state that compares the average covered charges to the average total payments
library(zipcode)
data(zipcode)
hospital.data.lat.lon <- hospital.data %>% 
  mutate(zip = paste(Provider.Zip.Code)) %>% 
  left_join(zipcode, by="zip")
source("scripts/getcounty.r")
hospital.data.county <- hospital.data.lat.lon[, 17:16] %>% 
  filter(!is.na(latitude), !is.na(longitude)) %>% 
  latlong2county()
# Need to add latitude and longitude to county names
hospital.data.county <- hospital.data.lat.lon %>%
  left_join(hospital.data.county, by="latitude", copy=TRUE)
```